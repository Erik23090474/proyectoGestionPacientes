<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-5 p-4 bg-white rounded-4 shadow-sm">
    <div>
      <h2 class="fw-bold mb-0 text-dark">Gesti√≥n de Pacientes</h2>
      <p class="text-muted mb-0" *ngIf="user$ | async as user">
        Bienvenido al sistema, <span class="text-primary fw-semibold">{{ $any(user).displayName }}</span>
      </p>
    </div>
    <div *ngIf="user$ | async">
      <button class="btn btn-outline-danger d-flex align-items-center gap-2" (click)="logout()">
        <span>Cerrar Sesi√≥n</span>
      </button>
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-5">
    <div class="card-header bg-white py-3">
      <h4 class="mb-0 fw-bold">
        {{ editingId ? 'üìù Editar Informaci√≥n' : '‚ûï Nuevo Registro' }}
      </h4>
    </div>
    <div class="card-body p-4">
      <form [formGroup]="pacienteForm" (ngSubmit)="onSubmit()">
        <div class="row g-4">
          <div class="col-md-6">
            <label class="form-label fw-semibold">Nombre(s) *</label>
            <input type="text" 
                   class="form-control form-control-lg" 
                   placeholder="Escribe aqu√≠ el nombre"
                   formControlName="nombre"
                   [class.is-invalid]="pacienteForm.get('nombre')?.invalid && pacienteForm.get('nombre')?.touched">
            <div class="invalid-feedback" *ngIf="pacienteForm.get('nombre')?.errors?.['required']">El nombre es obligatorio</div>
            <div class="invalid-feedback" *ngIf="pacienteForm.get('nombre')?.errors?.['pattern']">Solo se permiten letras</div>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Apellidos *</label>
            <input type="text" 
                   class="form-control form-control-lg" 
                   placeholder="Escribe aqu√≠ el apellido"
                   formControlName="apellidos"
                   [class.is-invalid]="pacienteForm.get('apellidos')?.invalid && pacienteForm.get('apellidos')?.touched">
            <div class="invalid-feedback">Verifica los apellidos (m√≠n. 3 letras)</div>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Fecha de Nacimiento *</label>
            <input type="date" 
                   class="form-control form-control-lg" 
                   formControlName="fechaNacimiento"
                   [class.is-invalid]="pacienteForm.get('fechaNacimiento')?.invalid && pacienteForm.get('fechaNacimiento')?.touched">
            <div class="invalid-feedback">La fecha es requerida</div>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Correo Electr√≥nico *</label>
            <input type="email" 
                   class="form-control form-control-lg" 
                   placeholder="Escribe aqu√≠ el correo"
                   formControlName="correoElectronico"
                   [class.is-invalid]="pacienteForm.get('correoElectronico')?.invalid && pacienteForm.get('correoElectronico')?.touched">
            <div class="invalid-feedback">Ingresa un correo v√°lido</div>
          </div>

          <div class="col-12">
            <label class="form-label fw-semibold">Domicilio Completo *</label>
            <textarea class="form-control form-control-lg" 
                      rows="2"
                      placeholder="Calle, N√∫mero, Colonia..."
                      formControlName="domicilio"
                      [class.is-invalid]="pacienteForm.get('domicilio')?.invalid && pacienteForm.get('domicilio')?.touched">
            </textarea>
            <div class="invalid-feedback">El domicilio es necesario</div>
          </div>
        </div>

        <div class="d-flex gap-3 mt-4">
          <button type="submit" class="btn btn-primary btn-lg px-5 shadow-sm">
            {{ editingId ? 'Actualizar Paciente' : 'Guardar Paciente' }}
          </button>
          <button type="button" 
                  class="btn btn-light btn-lg px-4 border" 
                  (click)="resetForm()"
                  *ngIf="editingId">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="card border-0 shadow-sm overflow-hidden">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
      <h4 class="mb-0 fw-bold">Lista de Registros</h4>
      <span class="badge bg-light text-primary border border-primary-subtle px-3 py-2 rounded-pill">
        {{ pacientes.length }} pacientes en total
      </span>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Nombre Completo</th>
              <th>Fecha Nac.</th>
              <th>Domicilio</th>
              <th>Correo</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let paciente of pacientes">
              <td class="ps-4">
                <div class="fw-bold text-dark">{{ paciente.nombre }}</div>
                <div class="text-muted small">{{ paciente.apellidos }}</div>
              </td>
              <td>{{ paciente.fechaNacimiento | date:'dd/MM/yyyy' }}</td>
              <td class="text-truncate" style="max-width: 200px;">{{ paciente.domicilio }}</td>
              <td>
                <span class="text-primary">{{ paciente.correoElectronico | emailFormat }}</span>
              </td>
              <td class="text-center pe-4">
                <div class="d-flex justify-content-center gap-2">
                  <button class="btn btn-sm btn-warning shadow-sm" (click)="editPaciente(paciente)">
                    Editar
                  </button>
                  <button class="btn btn-sm btn-danger shadow-sm" (click)="deletePaciente(paciente.id)">
                    Eliminar
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="pacientes.length === 0">
              <td colspan="5" class="text-center py-5 text-muted">
                <div class="mb-2">üìÅ</div>
                No hay pacientes registrados actualmente.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>